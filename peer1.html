<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Peer 1</title>
  </head>
  <body>
    <p>Peer 1</p>
    <input type="text" id="sdp" placeholder="Enter SDP" />
    <button onclick="submit()">Connect</button>
<br><br>
    <div>
      <input type="text" id="message" placeholder="Enter message" />
      <button onclick="sendMessage()">Send</button>
    </div>
    <p id="messages"></p>
  </body>
  <script>
    var messages=[]
    const peer = new RTCPeerConnection();
    const dataChannel = peer.createDataChannel("datachannel");

    var paragraphElement = document.getElementById("messages");

function updateParagraph() {
    var content = "History:<br>";
    messages.forEach(function(value, index) {
        content += `${index + 1}. ${value}<br>`;
    });
    paragraphElement.innerHTML = content;
}

    peer.onicecandidate = (event) => {
      if (event.candidate) {
        console.log(
          "SDP added, here is new",
          JSON.stringify(peer.localDescription)
        );
      }
    };

    dataChannel.onmessage = (event) => {
      console.log("Message received",event.data);
      messages.push(event.data);
      updateParagraph();
    };

    dataChannel.onopen = () => {
      console.log("Data channel open");
    };

    dataChannel.onclose = () => {
      console.log("Data channel close");
    };

    peer
      .createOffer()
      .then((offer) => peer.setLocalDescription(offer))
      .catch((error) => console.error("Error creating offer:", error));

    function submit() {
      const remoteSdp = JSON.parse(document.getElementById("sdp").value);
      peer.setRemoteDescription(remoteSdp);
    }

    function sendMessage(){
      const message = document.getElementById("message").value;
      dataChannel.send(message);
      messages.push(message);
      updateParagraph();
    }
  </script>
</html>
